{
  "filename": "microservice-framework-integrations.md",
  "__html": "<h1>Microservice Framework Integrations</h1>\n<h2>Web frameworks</h2>\n<h3>Web Servlet</h3>\n<p>Sentinel provides Web Servlet filter integration to enable flow control for web requests. Add the following dependency in <code>pom.xml</code> (if you are using Maven):</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>sentinel-web-servlet<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>x.y.z<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<p>To use the filter, you can simply configure your <code>web.xml</code> with:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">filter</span>&gt;</span>\n\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">filter-name</span>&gt;</span>SentinelCommonFilter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">filter-name</span>&gt;</span>\n\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">filter-class</span>&gt;</span>com.alibaba.csp.sentinel.adapter.servlet.CommonFilter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">filter-class</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">filter</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">filter-mapping</span>&gt;</span>\n\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">filter-name</span>&gt;</span>SentinelCommonFilter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">filter-name</span>&gt;</span>\n\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">url-pattern</span>&gt;</span>/*<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">url-pattern</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">filter-mapping</span>&gt;</span>\n</code></pre>\n<p>For Spring web applications you can configure with Spring bean:</p>\n<pre><code class=\"language-java\"><span class=\"hljs-meta\">@Configuration</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FilterConfig</span> </span>{\n\n    <span class=\"hljs-meta\">@Bean</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> FilterRegistrationBean <span class=\"hljs-title\">sentinelFilterRegistration</span><span class=\"hljs-params\">()</span> </span>{\n        FilterRegistrationBean&lt;Filter&gt; registration = <span class=\"hljs-keyword\">new</span> FilterRegistrationBean&lt;&gt;();\n        registration.setFilter(<span class=\"hljs-keyword\">new</span> CommonFilter());\n        registration.addUrlPatterns(<span class=\"hljs-string\">\"/*\"</span>);\n        registration.setName(<span class=\"hljs-string\">\"sentinelFilter\"</span>);\n        registration.setOrder(<span class=\"hljs-number\">1</span>);\n\n        <span class=\"hljs-keyword\">return</span> registration;\n    }\n}\n</code></pre>\n<p>When a request is blocked, Sentinel servlet filter will give a default page indicating the request blocked.\nIf customized block page is set (via <code>WebServletConfig.setBlockPage(blockPage)</code> method),\nthe filter will redirect the request to provided URL. You can also implement your own\nblock handler (the <code>UrlBlockHandler</code> interface) and register to <code>WebCallbackManager</code>.</p>\n<p>The <code>UrlCleaner</code> interface is designed to clean and unify the URL resource.\nFor REST APIs, you have to clean the URL resource (e.g. <code>/foo/1</code> and <code>/foo/2</code> -&gt; <code>/foo/:id</code>), or\nthe amount of context and resources will exceed the threshold.</p>\n<p>The <code>RequestOriginParser</code> interface is useful for extracting request origin (e.g. IP or appName from HTTP Header)\nfrom the HTTP request. You can implement your own <code>RequestOriginParser</code> and register to <code>WebCallbackManager</code>.</p>\n<h3>Spring Cloud</h3>\n<p>Spring Cloud Alibaba Sentinel provides out-of-box integration with Sentinel for Spring Cloud applications and services (Spring Web, Spring WebFlux, RestTemplate, Feign, Spring Cloud Gateway).</p>\n<p>Please refer to <a href=\"https://github.com/spring-cloud-incubator/spring-cloud-alibaba\">Spring Cloud Alibaba</a> for more information. Demo: <a href=\"https://github.com/sentinel-group/sentinel-guides/tree/master/sentinel-guide-spring-cloud\">sentinel-guide-spring-cloud</a></p>\n<h3>Spring WebFlux</h3>\n<blockquote>\n<p>Note: supported since Sentinel 1.5.0. This module requires JDK 8 or later versions.</p>\n</blockquote>\n<p>See <a href=\"https://github.com/alibaba/Sentinel/blob/master/sentinel-adapter/sentinel-spring-webflux-adapter/README.md\">the document of Sentinel Spring WebFlux Adapter module</a>.</p>\n<h2>RPC frameworks</h2>\n<h3>Dubbo</h3>\n<p><a href=\"https://github.com/dubbo/dubbo-sentinel-support\">Sentinel Dubbo Adapter</a> provides service consumer filter and provider filter for Dubbo services. Since Dubbo 2.7.x is not compatible with the previous version, we provide two modules:</p>\n<ul>\n<li><code>sentinel-apache-dubbo-adapter</code> (compatible with Apache Dubbo <strong>2.7.x</strong> and later version, supported since Sentinel <strong>1.5.1</strong>)</li>\n<li><code>sentinel-dubbo-adapter</code> (compatible with Dubbo <strong>2.6.x</strong> and previous version)</li>\n</ul>\n<p>If you are using Apache Dubbo <strong>2.7.x</strong> and later version, you can add the following dependency:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>sentinel-apache-dubbo-adapter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>x.y.z<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<p>If you are using Dubbo <strong>2.6.x</strong> or previous version, you can add the following dependency:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>sentinel-dubbo-adapter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>x.y.z<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<p>The adapter filters are enabled by default. Once you add the dependency, the Dubbo services and methods will become protected resources in Sentinel, which can leverage Sentinel's flow control and guard ability when rules are configured.</p>\n<p>If you don't want to enable the filter, you can manually disable it. For example:</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-comment\">&lt;!-- disable the Sentinel Dubbo consumer filter --&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dubbo:consumer</span> <span class=\"hljs-attr\">filter</span>=<span class=\"hljs-string\">\"-sentinel.dubbo.consumer.filter\"</span>/&gt;</span>\n</code></pre>\n<p>The guarded resource can be both service interface and service method:</p>\n<ul>\n<li>Service interface：resourceName format is <code>interfaceName</code>，e.g. <code>com.alibaba.csp.sentinel.demo.dubbo.FooService</code></li>\n<li>Service method：resourceName format is <code>interfaceName:methodSignature</code>，e.g. <code>com.alibaba.csp.sentinel.demo.dubbo.FooService:sayHello(java.lang.String)</code></li>\n</ul>\n<p>Sentinel Dubbo Adapter supports global fallback configuration.\nThe global fallback will handle exceptions and give the replacement result when blocked by\nflow control, degrade or system load protection. You can implement your own <code>DubboFallback</code> interface\nand then register to <code>DubboFallbackRegistry</code>. If no fallback is configured, Sentinel will wrap the <code>BlockException</code>\nthen directly throw it out. Besides, we can also leverage <a href=\"http://dubbo.apache.org/en-us/docs/user/demos/local-mock.html\">Dubbo mock mechanism</a> to provide the fallback implementation of degraded Dubbo services.</p>\n<p>For Sentinel's best practice in Dubbo, please refer to <a href=\"http://dubbo.apache.org/en-us/blog/sentinel-introduction-for-dubbo.html\">Sentinel: the flow sentinel of Dubbo</a>.</p>\n<p>For more details of Dubbo filter, see <a href=\"http://dubbo.apache.org/en-us/docs/dev/impls/filter.html\">here</a>.</p>\n<h3>gRPC</h3>\n<p>Sentinel provides integration with <a href=\"https://github.com/grpc/grpc-java\">gRPC Java</a>. Sentinel gRPC Adapter provides client and server interceptor for gRPC services. Add the following dependency in <code>pom.xml</code> (if you are using Maven):</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>sentinel-grpc-adapter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>x.y.z<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<p>To use Sentinel gRPC Adapter, you simply need to register the <code>Interceptor</code> to your client or server. The client sample:</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ServiceClient</span> </span>{\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> ManagedChannel channel;\n\n    ServiceClient(String host, <span class=\"hljs-keyword\">int</span> port) {\n        <span class=\"hljs-keyword\">this</span>.channel = ManagedChannelBuilder.forAddress(host, port)\n            .intercept(<span class=\"hljs-keyword\">new</span> SentinelGrpcClientInterceptor()) <span class=\"hljs-comment\">// Add the client interceptor.</span>\n            .build();\n        <span class=\"hljs-comment\">// Init your stub here.</span>\n    }\n}\n</code></pre>\n<p>The server sample；</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">import</span> io.grpc.Server;\n\nServer server = ServerBuilder.forPort(port)\n     .addService(<span class=\"hljs-keyword\">new</span> MyServiceImpl()) <span class=\"hljs-comment\">// Add your service.</span>\n     .intercept(<span class=\"hljs-keyword\">new</span> SentinelGrpcServerInterceptor()) <span class=\"hljs-comment\">// Add the server interceptor.</span>\n     .build();\n</code></pre>\n<blockquote>\n<p>Note that currently the interceptor only supports unary methods in gRPC.</p>\n</blockquote>\n<h2>Reactive support</h2>\n<h3>Reactor</h3>\n<blockquote>\n<p>Note: supported since Sentinel 1.5.0. This module requires JDK 8 or later versions.</p>\n</blockquote>\n<p>Sentinel provides integration module for <a href=\"https://projectreactor.io/\">Reactor</a>.</p>\n<p>Add the following dependency in <code>pom.xml</code> (if you are using Maven):</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>sentinel-reactor-adapter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>x.y.z<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<p>Example:</p>\n<pre><code class=\"language-java\">someService.doSomething() <span class=\"hljs-comment\">// return type: Mono&lt;T&gt; or Flux&lt;T&gt;</span>\n   .transform(<span class=\"hljs-keyword\">new</span> SentinelReactorTransformer&lt;&gt;(resourceName)) <span class=\"hljs-comment\">// transform here</span>\n   .subscribe();\n</code></pre>\n<h2>API Gateway support</h2>\n<h3>Spring Cloud Gateway</h3>\n<blockquote>\n<p>Note: this module requires Java 8 or later version.</p>\n</blockquote>\n<p>Sentinel provides an integration module with Spring Cloud Gateway, which supports flow control for routes and customized API groups. The integration module is based on the Sentinel Reactor Adapter.</p>\n<p>Add the following dependency in <code>pom.xml</code> (if you are using Maven):</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba.csp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>sentinel-spring-cloud-gateway-adapter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>x.y.z<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<p>Then you only need to inject the corresponding <code>SentinelGatewayFilter</code> and <code>SentinelGatewayBlockExceptionHandler</code> instance\nin Spring configuration. For example:</p>\n<pre><code class=\"language-java\"><span class=\"hljs-meta\">@Configuration</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">GatewayConfiguration</span> </span>{\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> List&lt;ViewResolver&gt; viewResolvers;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> ServerCodecConfigurer serverCodecConfigurer;\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">GatewayConfiguration</span><span class=\"hljs-params\">(ObjectProvider&lt;List&lt;ViewResolver&gt;&gt; viewResolversProvider,\n                                ServerCodecConfigurer serverCodecConfigurer)</span> </span>{\n        <span class=\"hljs-keyword\">this</span>.viewResolvers = viewResolversProvider.getIfAvailable(Collections::emptyList);\n        <span class=\"hljs-keyword\">this</span>.serverCodecConfigurer = serverCodecConfigurer;\n    }\n\n    <span class=\"hljs-meta\">@Bean</span>\n    <span class=\"hljs-meta\">@Order</span>(-<span class=\"hljs-number\">1</span>)\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> SentinelGatewayBlockExceptionHandler <span class=\"hljs-title\">sentinelGatewayBlockExceptionHandler</span><span class=\"hljs-params\">()</span> </span>{\n        <span class=\"hljs-comment\">// Register the block exception handler for Spring Cloud Gateway.</span>\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> SentinelGatewayBlockExceptionHandler(viewResolvers, serverCodecConfigurer);\n    }\n\n    <span class=\"hljs-meta\">@Bean</span>\n    <span class=\"hljs-meta\">@Order</span>(-<span class=\"hljs-number\">1</span>)\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> GlobalFilter <span class=\"hljs-title\">sentinelGatewayFilter</span><span class=\"hljs-params\">()</span> </span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> SentinelGatewayFilter();\n    }\n}\n</code></pre>\n<p>The gateway adapter will regard all <code>routeId</code> (defined in Spring properties) and all customized API definitions\n(defined in <code>GatewayApiDefinitionManager</code> of <code>sentinel-api-gateway-adapter-common</code> module) as resources.</p>\n<p>You can register various customized callback in <code>GatewayCallbackManager</code>:</p>\n<ul>\n<li><code>setBlockHandler</code>: register a customized <code>BlockRequestHandler</code> to handle the blocked request. The default implementation is <code>DefaultBlockRequestHandler</code>, which returns default message like <code>Blocked by Sentinel: FlowException</code>.</li>\n</ul>\n<p>For more details you could refer to <a href=\"./api-gateway-flow-control.md\">the document of API gateway flow control</a>.</p>\n<h3>Zuul 1.x</h3>\n<p>Sentinel Zuul Adapter provides <strong>route level</strong> and <strong>customized API level</strong>\nflow control for Zuul 1.x. Please refer to <a href=\"https://github.com/alibaba/Sentinel/tree/master/sentinel-adapter/sentinel-zuul-adapter\">the document here</a>.</p>\n<h2>Service Mesh</h2>\n<h3>Envoy</h3>\n<p>See <a href=\"./envoy-global-rate-limiting-support.md\">Envoy Global Rate Limiting Support</a>.</p>\n"
}