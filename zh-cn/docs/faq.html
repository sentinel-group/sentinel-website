<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163094446-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-163094446-1');
	</script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="faq" />
	<meta name="description" content="faq" />
	<!-- 网页标签标题 -->
	<title>faq</title>
	<link rel="shortcut icon" href="/img/sentinel.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/sentinel_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/zh-cn/docs/introduction.html" target="_self">文档</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/docs/developers/developers_dev.html" target="_self">开发者</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/blog/index.html" target="_self">博客</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/community/index.html" target="_self">社区</a></li><li class="menu-item menu-item-normal"><a href="https://www.aliyun.com/product/ahas" target="_self">企业版 Sentinel</a><img class="menu-img" src="https://img.alicdn.com/tfs/TB1esl_m.T1gK0jSZFrXXcNCXXa-200-200.png"/></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>用户文档</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>入门<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/introduction.html" target="_self">Sentinel 介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/quick-start.html" target="_self">快速开始</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/basic-implementation.html" target="_self">基本原理</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/faq.html" target="_self">FAQ</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>使用文档<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/basic-api-resource-rule.html" target="_self">基本使用（资源与规则）</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/flow-control.html" target="_self">流量控制</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/circuit-breaking.html" target="_self">熔断降级</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/system-adaptive-protection.html" target="_self">系统自适应保护</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/cluster-flow-control.html" target="_self">集群流量控制</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-gateway-flow-control.html" target="_self">网关流量控制</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/parameter-flow-control.html" target="_self">热点参数限流</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/origin-authority-control.html" target="_self">来源访问控制</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/annotation-support.html" target="_self">注解支持</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/dynamic-rule-configuration.html" target="_self">动态规则扩展</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/logs.html" target="_self">日志</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/metrics.html" target="_self">实时监控</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/general-configuration.html" target="_self">启动配置项</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/dashboard.html" target="_self">Sentinel 控制台</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/open-source-framework-integrations.html" target="_self">开源框架适配</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/polyglot-support.html" target="_self">多语言支持</a></li></ul></li><li class="menu-item menu-item-level-1"><span>多语言文档</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Sentinel Go<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/basic-api-usage.html" target="_self">基本 API 使用指南</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/flow-control.html" target="_self">流量控制</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/circuit-breaking.html" target="_self">熔断降级</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/concurrency-limiting-isolation.html" target="_self">并发隔离控制</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/system-adaptive-protection.html" target="_self">系统自适应保护</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/hotspot-param-flow-control.html" target="_self">热点参数流控</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/dynamic-data-source-usage.html" target="_self">动态规则扩展</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/general-configuration.html" target="_self">通用配置</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/logging.html" target="_self">日志</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>贡献手册</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/contribution/contribution-guideline.html" target="_self">开源贡献指南</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>FAQ</h1>
<p>此处会列出关于 Sentinel 的常见问题以及相应的注意事项和解决方案。</p>
<h2>配置相关</h2>
<p>Q: 配置参数如何指定？</p>
<p>A: 可通过 JVM -D 参数指定。除 <code>project.name</code> 之外，其余参数还可通过 properties 文件指定，路径为 <code>${home}/logs/csp/${project.name}.properties</code>。详见 <a href="./general-configuration.md">启动项配置文档</a>。</p>
<hr>
<p>Q: 可否自定义 properties 文件的位置或日志文件的位置？</p>
<p>A: 1.3.0 版本开始支持配置日志文件的目录，可以参考 <a href="./general-configuration.md">启动项配置文档</a>；若希望自定义 properties 文件的位置或使用其它的加载方式，可以结合 Spring Cloud Alibaba Sentinel 使用。</p>
<h2>Sentinel 核心功能相关</h2>
<p>Q: Sentinel 可否用于生产环境？</p>
<p>A: 当然可以！Sentinel 可用于生产环境，但若要在生产环境中使用 Sentinel 控制台则还需要进行一些改造。</p>
<hr>
<h4>Q: 想从 Hystrix 迁移到 Sentinel，有没有相关指南？</h4>
<p>A: 可以参考 <a href="https://github.com/alibaba/Sentinel/wiki/Guideline:-%E4%BB%8E-Hystrix-%E8%BF%81%E7%A7%BB%E5%88%B0-Sentinel">Guideline: 从 Hystrix 迁移到 Sentinel</a>。</p>
<hr>
<p>Q: 我的服务是基于 Spring Boot 和 Dubbo 编写的，Sentinel 有相应的适配吗？</p>
<p>A: 当然啦，Sentinel 针对常用框架和库进行了适配，包括 Web Servlet、Dubbo、Spring Boot / Spring Cloud、gRPC 等，可以参见 <a href="https://github.com/alibaba/Sentinel/wiki/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E7%9A%84%E9%80%82%E9%85%8D">主流框架的适配</a>。</p>
<hr>
<p>Q: Sentinel 的性能如何？只进行埋点不配置规则，仅统计指标信息会有多少性能损耗？</p>
<p>A: 引入 Sentinel 带来的性能损耗非常小。只有在业务单机量级超过 25W QPS 的时候才会有一些显著的影响（10% 左右），单机 QPS 不太大的时候损耗几乎可以忽略不计。性能测试报告见 <a href="https://github.com/alibaba/Sentinel/wiki/Benchmark">Benchmark</a>。</p>
<hr>
<p>Q: 是否需要在初始化时手工调用 <code>InitExecutor.doInit()</code> 方法进行相应的初始化？</p>
<p>A: 不需要，sentinel-core 的 Env 类通过 static 块调用了此方法进行初始化，在首次调用资源时即可触发。一些 demo 中手动调用此方法是为了不让进程退出。</p>
<hr>
<p>Q: 降级规则生效后，除了抛异常之外还有没有其它的处理方式？</p>
<p>A: 可以利用 <a href="./annotation-support.md">Sentinel 注解</a> 来配置 fallback 函数，在资源被降级时进行相应处理。另外，对于 Dubbo 服务，我们支持注册全局的 fallback 函数，可参考 <a href="https://github.com/alibaba/Sentinel/wiki/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E7%9A%84%E9%80%82%E9%85%8D#dubbo">Dubbo 适配文档</a>。</p>
<hr>
<h4>Q: 怎么针对特定调用端限流？比如我想针对某个 IP 或者来源应用进行限流？规则里面 limitApp（流控应用）的作用？</h4>
<p>A: Sentinel 支持按来源限流，可以参考 <a href="https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6#%E5%9F%BA%E4%BA%8E%E8%B0%83%E7%94%A8%E5%85%B3%E7%B3%BB%E7%9A%84%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6">基于调用关系的限流</a>。注意 origin 数量不能太多，否则会导致内存暴涨，并且目前不支持模式匹配。</p>
<p>若 Web 应用使用了 Sentinel Web Filter，并希望对 HTTP 请求按照来源限流，则可以自己实现 <code>RequestOriginParser</code> 接口从 HTTP 请求中解析 origin 并注册至 <code>WebCallbackManager</code> 中。示例代码：</p>
<pre><code class="language-java">WebCallbackManager.setRequestOriginParser(ServletRequest::getRemoteAddr);
</code></pre>
<p>特别地，流控应用如果使用了 Sentinel Dubbo Adapter，同时 Dubbo 的消费者也引入了 Sentinel Dubbo Adapter（用于透传 <code>dubboApplication</code> 这个参数），则填 Dubbo 调用方的 application name 就好（注意是 Dubbo 里配置的应用名而不是 Sentinel 的应用名），消费端引入 adapter 就会自动透传，否则需要自己传来源应用名。</p>
<p>注意来源信息（<code>origin</code>）一般是在<strong>入口处</strong>传入的（如 HTTP 入口或 Dubbo 服务入口），因此在链路中间再通过 <code>ContextUtil.enter(xxx, origin)</code> 传入可能不会生效。</p>
<hr>
<p>Q: 很多开发通过错误码来处理流程，而非通过异常。这种写法，导致 Sentinel 不能拦截到异常，无法触发降级。对于这种情况，有没有什么好的处理方法？</p>
<p>A: 实际上 Sentinel 是通过 <code>Tracer.trace(e)</code> 来统计业务异常的，因此可以收到错误码就调用此函数来统计业务异常。</p>
<hr>
<p>Q: 手动通过 <code>SphU.entry(xxx)</code> 进行埋点具有侵入性，有没有低侵入性的方案？</p>
<p>A: 可以利用 <a href="https://github.com/alibaba/Sentinel/wiki/%E6%B3%A8%E8%A7%A3%E6%94%AF%E6%8C%81">Sentinel 注解支持</a> 或者 <a href="https://github.com/alibaba/Sentinel/wiki/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E7%9A%84%E9%80%82%E9%85%8D">各种框架的适配</a>。</p>
<hr>
<p>Q: Sentinel 未来会考虑支持分布式链路调用跟踪吗？</p>
<p>A: Sentinel 的核心功能是流量控制和限流降级。分布式链路调用跟踪不是 Sentinel 关注的功能，可以参考其它分布式链路调用跟踪系统。</p>
<hr>
<p>Q: Sentinel 支持集群限流吗？</p>
<p>A: 1.4.0 版本开始已经支持，可以参考 <a href="https://github.com/alibaba/Sentinel/wiki/%E9%9B%86%E7%BE%A4%E6%B5%81%E6%8E%A7">集群流控文档</a>。</p>
<hr>
<p>Q: Web 端的资源目前都是根据某个特定的 URL 限流，可不可以根据前缀匹配限流？</p>
<p>A: 对于 Sentinel Web Servlet Filter，可以借助 <code>UrlCleaner</code> 处理对应的 URL（如提取前缀的操作），这样对应的资源都会归到处理后的资源（如 <code>/foo/1</code> 和 <code>/foo/2</code> 都归到 <code>/foo/*</code> 资源里面）。<code>UrlCleaner</code> 实现 URL 前缀匹配只是个 trick，它会把对应的资源也给归一掉，直接在资源名粒度上实现模式匹配还是有很多顾虑的问题的。</p>
<h2>Sentinel 集群限流相关</h2>
<h4>Q: 集群限流没有生效？</h4>
<p>A: 请参考以下步骤排查：</p>
<ul>
<li>请确保接入端引入了 Sentinel 集群流控相关的依赖；</li>
<li>检查 <code>~/logs/csp/sentinel-record.log</code> 查看 Token Server / Client 是否加载成功，是否成功启动；客户端规则和集群规则是否都接收成功；</li>
<li>在 Token Client 端检查 <code>~/logs/csp/sentinel-cluster-client.log</code> 日志，看一下是否是 Token Server 未启动或者规则未接收到的问题；</li>
<li>若从开源 Sentinel 控制台推送集群规则，请务必确保按照 <a href="https://github.com/alibaba/Sentinel/wiki/Sentinel-%E6%8E%A7%E5%88%B6%E5%8F%B0%EF%BC%88%E9%9B%86%E7%BE%A4%E6%B5%81%E6%8E%A7%E7%AE%A1%E7%90%86%EF%BC%89">Sentinel 集群流控控制台文档</a> 进行了相应改造，并且接入端按照 <a href="https://github.com/alibaba/Sentinel/wiki/%E9%9B%86%E7%BE%A4%E6%B5%81%E6%8E%A7#%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%99%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F">集群规则配置文档</a> 配置了相关动态规则源；</li>
</ul>
<hr>
<p>Q: 通过 Sentinel 控制台或 API 来分配管理 Token Server 时，返回错误：token client/server mode not available: no SPI found</p>
<p>A: 请确保接入端引入了 Sentinel 集群流控相关的依赖（嵌入模式两者都需要）：</p>
<ul>
<li>Token Client: <code>sentinel-cluster-client-default</code></li>
<li>Token Server: <code>sentinel-cluster-server-default</code></li>
</ul>
<p>更多信息可参见 <a href="https://github.com/alibaba/Sentinel/wiki/%E9%9B%86%E7%BE%A4%E6%B5%81%E6%8E%A7#%E6%A8%A1%E5%9D%97%E7%BB%93%E6%9E%84">集群流控文档</a>。</p>
<hr>
<p>Q: 集群流控规则中“单机均摊”阈值模式是什么意思？</p>
<p>A: 单机均摊模式下配置的阈值等同于单机能够承受的平均限额。Token Server 会根据客户端对应的 namespace（默认为 <code>project.name</code> 定义的应用名）下的连接数来计算总的阈值（比如独立模式下有 3 个 client 连接到了 token server，然后配的单机均摊阈值为 10，则计算出的集群总量就为 30）。<strong>单机均摊阈值仅用于计算总体阈值，不是说每台机器一定要控制在均摊阈值上</strong>。配置方式：若希望某个资源限制集群总量为 Q，服务实例为 N，则可以配置单机均摊阈值为 <code>Q / N</code>。</p>
<hr>
<p>Q: 集群流控 Token Server 中的 namespace set 有什么用处？</p>
<p>A: namespace set 即 Token Server 服务的作用域（命名空间集合），用于指定该 Token Server 可以为哪些应用提供集群流控服务，一般设置为接入端应用名的集合。Token Client 在连接到 token server 后会上报自己的命名空间（默认为 <code>project.name</code> 配置的应用名），token server 会根据上报的命名空间名称统计连接数。</p>
<ul>
<li>嵌入模式下一般仅服务自身，默认嵌入模式的 namespace set 为该应用本身</li>
<li>所有 Token Server 都自带一个默认的命名空间 <code>default</code>，一般情况下不会用到</li>
</ul>
<h2>Sentinel Transport/Dashboard 相关</h2>
<p>Q：Sentinel Transport 同一台机器起相同的端口不报错？如果几个应用都没配 <code>csp.sentinel.api.port</code> 会出错吗？</p>
<p>A: 对于 <code>sentinel-transport-simple-http</code>，默认 8719 端口被占用以后会自动选择下一个端口，直到有可用的端口为止。选择端口时间会比较长，本地如果起多个应用建议自己通过 <code>csp.sentinel.api.port</code> 设置端口。</p>
<hr>
<p>Q: 为什么 Sentinel Transport 模块里自己用原生 Socket 或 Netty 自己实现的 HTTP Server，为什么不用 Web 容器（如 Tomcat）？</p>
<p>A: 使用 Web 容器作为一个组件来说太过于重量级了，因此我们自己实现了简单的 <code>sentinel-transport-simple-http</code> 和 <code>sentinel-transport-netty-http</code> 模块，两个模块的功能是相同的，一般用 <code>sentinel-transport-simple-http</code> 即可，而 <code>sentinel-transport-netty-http</code> 是为了后续的可扩展性和兼容性而设计的。</p>
<hr>
<p>Q: 目前 Sentinel Transport 里面可否自己扩展添加 command？</p>
<p>A: 可以的，用户可以自行实现 <code>CommandHandler</code> 接口，并在实现类上加上 <code>@CommandMapping</code> 注解（代表 command name）。接着在资源目录下的 <code>META-INF/services</code> 目录下添加 <code>com.alibaba.csp.sentinel.command.CommandHandler</code> 文件（如果没有的话），在文件里加上自己的实现类的全名即可。比如：</p>
<pre><code class="language-java"><span class="hljs-keyword">package</span> io.test;

<span class="hljs-meta">@CommandMapping</span>(name = <span class="hljs-string">"test"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestCommandHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CommandHandler</span>&lt;<span class="hljs-title">String</span>&gt; </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CommandResponse&lt;String&gt; <span class="hljs-title">handle</span><span class="hljs-params">(CommandRequest request)</span> </span>{
        <span class="hljs-keyword">return</span> CommandResponse.ofSuccess(<span class="hljs-string">"666"</span>);
    }
}
</code></pre>
<p>在自己项目目录下的 <code>resources/META-INF/services/com.alibaba.csp.sentinel.command.CommandHandler</code> 文件中添加：</p>
<pre><code>io.test.TestCommandHandler
</code></pre>
<p>这样初始化 Sentinel Transport Server 的时候，对应的 command 就会自动注册，可以通过 <code>curl host:ip/test</code> 来验证是否成功。</p>
<hr>
<h4>Q: 想要在生产环境中使用 Sentinel 控制台，还需要进行哪些改造？</h4>
<p>A: 在生产环境中使用 Sentinel 控制台需要考虑下面的问题：</p>
<ul>
<li>监控数据持久化</li>
<li>规则推送支持应用维度，并且整合配置中心以便可以直接推送至远程配置中心</li>
<li>权限控制</li>
</ul>
<p>详细指南请参考此 blog: <a href="https://github.com/alibaba/Sentinel/wiki/%E5%9C%A8%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%AD%E4%BD%BF%E7%94%A8-Sentinel">在生产环境中使用 Sentinel 控制台</a>。</p>
<hr>
<h4>Q: 已经引入了适配模块（比如 <code>sentinel-dubbo-adapter</code>），然而在 Sentinel 控制台上没有找到我的应用？</h4>
<p>A: 请确保对应的依赖和参数配置正确。接入控制台需要上报的客户端依赖，如 <code>sentinel-transport-simple-http</code>，<strong>不引入相关依赖则无法将相关信息上报到控制台</strong>。参数配置详情请参考 <a href="https://github.com/alibaba/Sentinel/wiki/%E6%8E%A7%E5%88%B6%E5%8F%B0">Sentinel 控制台文档</a>。</p>
<p>详细的排查步骤请见下面。</p>
<hr>
<h4>Q: Sentinel 控制台没有显示我的应用，或者没有监控展示，如何排查？</h4>
<p>A: Sentinel Dashboard 是一个单独启动的控制台，应用若想上报监控信息给 Sentinel 控制台，需要引入 Sentinel 上报信息的客户端。它们各自有自己的通信端口，其中控制台的端口可通过启动参数 <code>-Dserver.port=xxxx</code> 进行配置，而 Sentinel 客户端的端口可以通过启动参数 <code>-Dcsp.sentinel.api.port</code> 进行配置（默认是 <strong>8719</strong>）。两者都启动之后，Sentinel 客户端在首次访问资源时会初始化并给控制台发送心跳，之后控制台会通过客户端提供的端口对 Sentinel 客户端进行访问来拉取相关信息。基于此，接入控制台需要的步骤如下：</p>
<ol>
<li>接入 Sentinel 的应用应该引入 Sentinel 客户端通信的基础 jar 包，如 <code>sentinel-transport-simple-http</code></li>
<li>客户端启动时添加相应的 JVM 参数，包括：
<ul>
<li>应用名称：<code>-Dproject.name=xxxx</code></li>
<li>控制台地址：<code>-Dcsp.sentinel.dashboard.server=ip:port</code></li>
<li>本地的 Sentinel 客户端端口：<code>-Dcsp.sentinel.api.port=xxxx</code>（默认是 8719）</li>
<li>参数配置详情请参考 <a href="https://github.com/alibaba/Sentinel/wiki/%E6%8E%A7%E5%88%B6%E5%8F%B0">Sentinel 控制台文档</a>。</li>
</ul>
</li>
<li>启动控制台，运行应用，当<strong>首次访问对应的资源后 等待一段时间</strong>即可在控制台上看到对应的应用以及相应的监控信息。可以通过 <code>curl http://ip:port/tree</code> 命令查看调用链，正常情况下会显示出已访问资源的调用链。</li>
</ol>
<p><strong>注意</strong>：Sentinel 会在客户端首次调用时候进行初始化，开始向控制台发送心跳包。因此需要确保客户端有访问量，才能在控制台上看到监控数据。另外，还是期待大家养成看日志的好习惯，详见 <a href="https://github.com/alibaba/Sentinel/wiki/%E6%97%A5%E5%BF%97">日志文档</a>。</p>
<ul>
<li>控制台推送规则的日志默认位于 <code>${user.home}/logs/csp/sentinel-dashboard.log</code></li>
<li>客户端接收规则日志默认位于 <code>${user.home}/logs/csp/sentinel-record.log.xxx</code></li>
</ul>
<p>常用排查问题列表：</p>
<ul>
<li>确认 Dashboard 已经正常启动并可以正常访问</li>
<li>若是 Spring Boot / Dubbo 等应用，请务必检查<strong>是否引入了整合依赖并进行了相应配置</strong></li>
<li><strong>检查接入端的启动参数配置是否正确（如控制台地址是否配置正确）</strong></li>
<li>通过 <code>~/logs/csp/sentinel-record.log</code> 日志排查客户端发送心跳包是否正常，是否正常上报给 Dashboard</li>
<li>确保 fastjson 的版本和 Sentinel 的依赖版本保持一致</li>
<li>通过 <code>curl IP:port/getRules?type=flow</code> 等命令查看结果，查看规则是否推送成功</li>
<li>发送到客户端的规则格式是否正确，例如确认一下降级规则的表单是否填写完整</li>
</ul>
<hr>
<h4>Q: 客户端和控制台不在一台机器上，客户端成功接入控制台后，控制台无法显示实时的监控数据？但簇点链路页面有实时请求数据（不为 0）？</h4>
<p>A: 请确保 Sentinel 控制台所在的机器时间与自己应用的机器时间保持一致（通过 NTP 等同步）。Sentinel 控制台是通过控制台所在机器的时间戳拉取监控数据的，因此时间不一致会导致拉不到实时的监控数据。</p>
<hr>
<p><strong>Q: 客户端成功接入控制台后，控制台配置规则准确无误，但是客户端收不到规则或者报错？比如配置的规则 resourceName 正确但却报 resourceName 为空的错误？</strong></p>
<p>A: 排查客户端是否使用了低版本的 fastjson，低版本的 fastjson 可能会有此问题，建议使用和 Sentinel 相关组件一致版本的 fastjson。</p>
<hr>
<p>Q: Sentinel 监控数据能保留多久？控制台聚合的统计数据可否进行持久化？</p>
<p>A: Sentinel 对监控数据的做法是定时落盘在客户端，然后 Sentinel 提供接口去拉取日志文件。所以 Sentinel 在监控数据上理论上是最少存储 1 天以上的数据；然而作为控制台展示，则仅在内存中聚合 5 分钟以内的统计数据，不进行持久化。</p>
<p>我们鼓励大家对 Dashboard 进行改造实现指标信息的持久化，并从其它的存储中（如 RDBMS、时序数据库等）拉取的监控信息，包括实时的和历史的数据。</p>
<hr>
<p>Q: Sentinel 控制台有登录或者细粒度的权限控制功能吗？</p>
<p>A: 目前是没有的，权限控制功能需要自己去定制。</p>
<hr>
<p>Q: Sentinel Dashboard 中簇点链路页面里面资源名称为什么会有重复的？</p>
<p>A: 最顶层的是 Context 名，用于区分不同调用链路（入口）。</p>
<hr>
<p><strong>Q: 应用已经退出了，Sentinel 控制台的应用列表里还有显示？</strong></p>
<p>A: 若应用已退出，过 5 分钟没有收到心跳，控制台就会标记对应机器为失联状态，但不会将对应应用从列表中移除。</p>
<hr>
<p>Q: 为什么说 Sentinel 控制台集群资源汇总仅支持 500 台以下的应用集群？</p>
<p>A: 因为 Sentinel 控制台仅作为示范，其监控聚合能力非常有限，但是应用端是没有限制的。若希望支持更多的机器，可以使用动态规则数据源并改造控制台；同时改造实现监控数据持久化。</p>
<hr>
<p><strong>Q: Sentinel 控制台规则配置里面“流控应用”是什么？</strong></p>
<p>A: 对应规则中的 <code>limitApp</code>，即请求来源，通过入口处 <code>ContextUtil.enter(contextName, origin)</code> 中的 <code>origin</code> 传入。参见上面的“按调用方进行限流”。</p>
<h2>规则存储与动态规则数据源（DataSource）</h2>
<p>Q: 动态规则数据源分为哪几种？各自的使用场景？</p>
<p>A: 数据源分为只读的数据源和可写入的数据源。</p>
<ul>
<li>可写入的数据源一般对应 pull 模式的数据源（如本地文件、RDBMS），从控制台推送规则时可先经 Sentinel 客户端更新到内存中，然后经注册的 <code>WritableDataSource</code> 写入到本地。</li>
<li>只读的数据源一般对应 push 模式的数据源（如配置中心等）。对于配置中心，写入的操作不应由数据源进行，数据源仅负责获取配置中心推送的配置并更新到本地。从控制台推送规则的次序应该是 配置中心控制台/Sentinel 控制台 → 配置中心 → Sentinel 数据源 → Sentinel，而不是经 Sentinel 数据源推送至配置中心。<strong>注意由于不同的生产环境可能使用不同的数据源，从 Sentinel 控制台推送至配置中心的实现需要用户自行改造。</strong></li>
</ul>
<hr>
<h4>Q: 在控制台配置的规则存在哪里？为什么应用重启规则就消失了？</h4>
<p>A: 在控制台配置的规则是存在内存里面的，没有进行持久化，因此应用重启后规则就消失了。</p>
<p>可以参考 <a href="https://github.com/alibaba/Sentinel/wiki/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%99%E6%89%A9%E5%B1%95">动态规则文档</a> 持久化存储规则。</p>
<hr>
<p><strong>Q: 我在客户端处配置了动态规则数据源（如基于 ZooKeeper / Nacos / Apollo 的数据源），然后在控制台处向客户端推送了规则，但是规则并没有写入到对应的数据源中？</strong></p>
<p>A: push 模式的数据源（如配置中心）都是<strong>只读</strong>的。对于配置中心类型的数据源（如 ZooKeeper），我们推荐在推送规则时直接推送至配置中心，然后配置中心再自动推送至所有的客户端（即 <code>Dashboard -&gt; Config Center -&gt; Sentinel DataSource -&gt; Sentinel</code>），<strong>目前需要自行改造控制台</strong>。可以参见：<a href="https://github.com/alibaba/Sentinel/wiki/%E5%9C%A8%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%AD%E4%BD%BF%E7%94%A8-Sentinel-%E6%8E%A7%E5%88%B6%E5%8F%B0">在生产环境中使用 Sentinel 控制台</a>。</p>
<p>对于 pull 模式的数据源（如本地文件），则可以向 transport-common 模块的 <code>WritableDataSourceRegistry</code> 注册写入数据源，在推送规则时会一并推送至本地数据源中。</p>
<h2>其它</h2>
<p>Q: 编译打包的时候 Maven 报错？</p>
<p>A: 请将 Maven 版本升级至较新版本（3.5.x）再进行构建。</p>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/sentinel_gray.png"/><div class="cols-container"><div class="col col-12"><h3>Disclaimer</h3><p>Sentinel is an open-source project under Apache License 2.0.</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/introduction.html" target="_self">概览</a></dd><dd><a href="/zh-cn/docs/quick-start.html" target="_self">快速开始</a></dd><dd><a href="/zh-cn/docs/contribution/contribution-guideline.html" target="_self">开发者指南</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="/zh-cn/blog/index.html" target="_self">博客</a></dd><dd><a href="/zh-cn/community/index.html" target="_self">社区</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2018 - 2020 The Sentinel Authors | An Alibaba Middleware (Aliware) Project</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>